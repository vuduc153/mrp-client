!function(e){var t=Array.isArray?Array.isArray:function e(t){return"[object Array]"===Object.prototype.toString.call(t)};function i(){this._events={},this._conf&&s.call(this,this._conf)}function s(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function n(e){this._events={},this.newListener=!1,s.call(this,e)}function r(e,t,i,s){if(!i)return[];var n,l,o,h,a,f,c,p=[],u=t.length,v=t[s],d=t[s+1];if(s===u&&i._listeners){if("function"==typeof i._listeners)return e&&e.push(i._listeners),[i];for(n=0,l=i._listeners.length;n<l;n++)e&&e.push(i._listeners[n]);return[i]}if("*"===v||"**"===v||i[v]){if("*"===v){for(o in i)"_listeners"!==o&&i.hasOwnProperty(o)&&(p=p.concat(r(e,t,i[o],s+1)));return p}if("**"===v){for(o in(c=s+1===u||s+2===u&&"*"===d)&&i._listeners&&(p=p.concat(r(e,t,i,u))),i)"_listeners"!==o&&i.hasOwnProperty(o)&&("*"===o||"**"===o?(i[o]._listeners&&!c&&(p=p.concat(r(e,t,i[o],u))),p=p.concat(r(e,t,i[o],s))):p=o===d?p.concat(r(e,t,i[o],s+2)):p.concat(r(e,t,i[o],s)));return p}p=p.concat(r(e,t,i[v],s+1))}if((h=i["*"])&&r(e,t,h,s+1),a=i["**"]){if(s<u)for(o in a._listeners&&r(e,t,a,u),a)"_listeners"!==o&&a.hasOwnProperty(o)&&(o===d?r(e,t,a[o],s+2):o===v?r(e,t,a[o],s+1):((f={})[o]=a[o],r(e,t,{"**":f},s+1)));else a._listeners?r(e,t,a,u):a["*"]&&a["*"]._listeners&&r(e,t,a["*"],u)}return p}function l(e,i){e="string"==typeof e?e.split(this.delimiter):e.slice();for(var s=0,n=e.length;s+1<n;s++)if("**"===e[s]&&"**"===e[s+1])return;for(var r=this.listenerTree,l=e.shift();l;){if(r[l]||(r[l]={}),r=r[l],0===e.length){if(r._listeners){if("function"==typeof r._listeners)r._listeners=[r._listeners,i];else if(t(r._listeners)&&(r._listeners.push(i),!r._listeners.warned)){var o=10;void 0!==this._events.maxListeners&&(o=this._events.maxListeners),o>0&&r._listeners.length>o&&(r._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",r._listeners.length),console.trace())}}else r._listeners=i;break}l=e.shift()}return!0}n.prototype.delimiter=".",n.prototype.setMaxListeners=function(e){this._events||i.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},n.prototype.event="",n.prototype.once=function(e,t){return this.many(e,1,t),this},n.prototype.many=function(e,t,i){var s=this;if("function"!=typeof i)throw Error("many only accepts instances of Function");function n(){0==--t&&s.off(e,n),i.apply(this,arguments)}return n._origin=i,this.on(e,n),s},n.prototype.emit=function(){this._events||i.call(this);var e,t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var s=arguments.length,n=Array(s-1),l=1;l<s;l++)n[l-1]=arguments[l];for(l=0,s=this._all.length;l<s;l++)this.event=t,this._all[l].apply(this,n)}if("error"===t&&!this._all&&!this._events.error&&!(this.wildcard&&this.listenerTree.error)){if(arguments[1]instanceof Error)throw arguments[1];throw Error("Uncaught, unspecified 'error' event.")}if(this.wildcard){e=[];var o="string"==typeof t?t.split(this.delimiter):t.slice();r.call(this,e,o,this.listenerTree,0)}else e=this._events[t];if("function"==typeof e){if(this.event=t,1===arguments.length)e.call(this);else if(arguments.length>1)switch(arguments.length){case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:for(var s=arguments.length,n=Array(s-1),l=1;l<s;l++)n[l-1]=arguments[l];e.apply(this,n)}return!0}if(!e)return!!this._all;for(var s=arguments.length,n=Array(s-1),l=1;l<s;l++)n[l-1]=arguments[l];for(var h=e.slice(),l=0,s=h.length;l<s;l++)this.event=t,h[l].apply(this,n);return h.length>0||!!this._all},n.prototype.on=function(e,s){if("function"==typeof e)return this.onAny(e),this;if("function"!=typeof s)throw Error("on only accepts instances of Function");if(this._events||i.call(this),this.emit("newListener",e,s),this.wildcard)return l.call(this,e,s),this;if(this._events[e]){if("function"==typeof this._events[e])this._events[e]=[this._events[e],s];else if(t(this._events[e])&&(this._events[e].push(s),!this._events[e].warned)){var n=10;void 0!==this._events.maxListeners&&(n=this._events.maxListeners),n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}else this._events[e]=s;return this},n.prototype.onAny=function(e){if("function"!=typeof e)throw Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(e),this},n.prototype.addListener=n.prototype.on,n.prototype.off=function(e,i){if("function"!=typeof i)throw Error("removeListener only takes instances of Function");var s,n=[];if(this.wildcard){var l="string"==typeof e?e.split(this.delimiter):e.slice();n=r.call(this,null,l,this.listenerTree,0)}else{if(!this._events[e])return this;s=this._events[e],n.push({_listeners:s})}for(var o=0;o<n.length;o++){var h=n[o];if(t(s=h._listeners)){for(var a=-1,f=0,c=s.length;f<c;f++)if(s[f]===i||s[f].listener&&s[f].listener===i||s[f]._origin&&s[f]._origin===i){a=f;break}if(a<0)continue;this.wildcard?h._listeners.splice(a,1):this._events[e].splice(a,1),0===s.length&&(this.wildcard?delete h._listeners:delete this._events[e]);break}(s===i||s.listener&&s.listener===i||s._origin&&s._origin===i)&&(this.wildcard?delete h._listeners:delete this._events[e])}return this},n.prototype.offAny=function(e){var t,i=0,s=0;if(e&&this._all&&this._all.length>0){for(i=0,s=(t=this._all).length;i<s;i++)if(e===t[i]){t.splice(i,1);break}}else this._all=[];return this},n.prototype.removeListener=n.prototype.off,n.prototype.removeAllListeners=function(e){if(0===arguments.length)return this._events&&i.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),s=r.call(this,null,t,this.listenerTree,0),n=0;n<s.length;n++)s[n]._listeners=null;else{if(!this._events[e])return this;this._events[e]=null}return this},n.prototype.listeners=function(e){if(this.wildcard){var s=[],n="string"==typeof e?e.split(this.delimiter):e.slice();return r.call(this,s,n,this.listenerTree,0),s}return this._events||i.call(this),this._events[e]||(this._events[e]=[]),t(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},n.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return n}):"object"==typeof exports?exports.EventEmitter2=n:window.EventEmitter2=n}();